<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>С новым годом, томичи!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../css/video-style.css" />
</head>

<body>
    <div id="loading">
        <img src="../Data/logo.gif" />
        <span class="loading-text">Загрузка, пожалуйста подождите...</span>
    </div>

    <!--
      ==================
      CAMERA VIDEO & CANVAS
      ==================
      -->

    <div id="app">
        <video loop autoplay muted playsinline id="video"></video>

        <canvas id="canvas"></canvas>
    </div>

    <script src="../js/third_party/three.js/stats.min.js"></script>
    <script src="../js/third_party/three.js/three.min.js"></script>
    <script src="../js/third_party/three.js/GLTFLoader.js"></script>
    <script src="threejs_worker_gltf.js"></script>

    <script>
        /**
         * APP / ELEMENTS
         */
        var container = document.getElementById("app");
        var video = document.getElementById("video");
        var canvas = document.getElementById("canvas");

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            var hint = {
                audio: false,
                video: true
            };

            if (window.innerWidth < 800) {
                hint = {
                    audio: false,
                    video: {
                        width: {
                            ideal: 480
                        },
                        height: {
                            ideal: 640
                        },
                        facingMode: {
                            exact: "environment"
                        }
                    },
                };
            }

            navigator.mediaDevices.getUserMedia(hint).then(function(stream) {
                video.srcObject = stream;
                video.addEventListener("loadedmetadata", function() {
                    video.play();

                    start(
                        container,
                        markers["pinball"],
                        video,
                        video.videoWidth,
                        video.videoHeight,
                        canvas,
                        null,
                        null,
                        null
                    );
                });
            });
        }
    </script>
</body>

</html>